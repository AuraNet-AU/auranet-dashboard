<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
      :root {
        --aura-primary: #6366f1;
        --aura-primary-dark: #4f46e5;
        --aura-success: #22c55e;
        --aura-danger: #ef4444;
        --aura-warning: #f59e0b;
      }
      
      * { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
      
      body {
        background: linear-gradient(180deg, #f0f4ff 0%, #fafafa 100%);
        min-height: 100vh;
      }
      
      .main-header {
        background: linear-gradient(135deg, var(--aura-primary) 0%, var(--aura-primary-dark) 100%);
        color: white;
        padding: 1.25rem 0;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
      }
      
      .logo-icon {
        width: 50px;
        height: 50px;
        background: rgba(255,255,255,0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }
      
      .status-pill {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.875rem;
      }
      
      .status-protected {
        background: rgba(34, 197, 94, 0.2);
        color: #166534;
        border: 2px solid rgba(34, 197, 94, 0.3);
      }
      
      .status-unprotected {
        background: rgba(239, 68, 68, 0.2);
        color: #991b1b;
        border: 2px solid rgba(239, 68, 68, 0.3);
      }
      
      .nav-link-custom {
        color: rgba(255,255,255,0.8);
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        transition: all 0.2s;
      }
      
      .nav-link-custom:hover, .nav-link-custom.active {
        color: white;
        background: rgba(255,255,255,0.15);
      }
      
      .aura-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin-bottom: 1.25rem;
        overflow: hidden;
        border: 1px solid rgba(0,0,0,0.05);
      }
      
      .aura-card-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        align-items: center;
      }
      
      .aura-card-header h2 {
        font-size: 1.125rem;
        font-weight: 700;
        margin: 0;
        color: #1e293b;
      }
      
      .aura-card-header .header-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.875rem;
        font-size: 1.125rem;
      }
      
      .aura-card-body { padding: 1.25rem; }
      
      .device-card {
        background: #f8fafc;
        border-radius: 12px;
        padding: 1rem 1.25rem;
        margin-bottom: 0.75rem;
        transition: all 0.2s;
        border: 2px solid transparent;
      }
      
      .device-card:hover {
        border-color: #e2e8f0;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      }
      
      .device-icon {
        width: 52px;
        height: 52px;
        border-radius: 12px;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        flex-shrink: 0;
      }
      
      .device-name {
        font-weight: 700;
        color: #1e293b;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      .device-name .edit-btn {
        opacity: 0;
        transition: opacity 0.2s;
        color: #94a3b8;
        cursor: pointer;
        padding: 0.25rem;
        font-size: 0.875rem;
      }
      
      .device-card:hover .device-name .edit-btn {
        opacity: 1;
      }
      
      .device-name .edit-btn:hover {
        color: var(--aura-primary);
      }
      
      .device-meta {
        font-size: 0.8125rem;
        color: #64748b;
        margin-top: 0.125rem;
      }
      
      .device-meta span {
        display: inline-flex;
        align-items: center;
      }
      
      .device-meta .separator {
        margin: 0 0.5rem;
        color: #cbd5e1;
      }
      
      .device-queries {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-top: 0.375rem;
      }
      
      .info-box {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        margin-bottom: 1.25rem;
        border-left: 4px solid #3b82f6;
      }
      
      .info-box.warning {
        background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        border-left-color: #f59e0b;
      }
      
      .info-box h4 {
        font-size: 0.9375rem;
        font-weight: 700;
        color: #1e40af;
        margin-bottom: 0.375rem;
        display: flex;
        align-items: center;
      }
      
      .info-box.warning h4 {
        color: #92400e;
      }
      
      .info-box p {
        font-size: 0.8125rem;
        color: #1e3a8a;
        margin: 0;
        line-height: 1.5;
      }
      
      .info-box.warning p {
        color: #78350f;
      }
      
      .alert {
        border: none;
        border-radius: 10px;
      }
      
      .main-footer {
        text-align: center;
        padding: 1.5rem 0;
        color: #64748b;
        font-size: 0.875rem;
      }
      
      .main-footer a {
        color: var(--aura-primary);
        text-decoration: none;
      }
      
      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #64748b;
      }
      
      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }
      
      .modal-content {
        border-radius: 16px;
        border: none;
      }
      
      .modal-header {
        border-bottom: 1px solid #f1f5f9;
        padding: 1.25rem 1.5rem;
      }
      
      .modal-body {
        padding: 1.5rem;
      }
      
      .modal-footer {
        border-top: 1px solid #f1f5f9;
        padding: 1rem 1.5rem;
      }
      
      .form-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.875rem;
      }
      
      .form-control {
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        font-size: 0.9375rem;
      }
      
      .form-control:focus {
        border-color: var(--aura-primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
      
      .form-text {
        font-size: 0.8125rem;
        color: #64748b;
      }
      
      .btn-aura {
        padding: 0.625rem 1.25rem;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.875rem;
        border: none;
        transition: all 0.2s ease;
      }
      
      .btn-aura-primary {
        background: linear-gradient(135deg, var(--aura-primary) 0%, var(--aura-primary-dark) 100%);
        color: white;
      }
      
      .btn-aura-primary:hover {
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.35);
        color: white;
        transform: translateY(-1px);
      }
      
      .btn-aura-outline {
        background: white;
        color: #64748b;
        border: 2px solid #e2e8f0;
      }
      
      .btn-aura-outline:hover {
        background: #f8fafc;
        border-color: #cbd5e1;
        color: #475569;
      }
      
      .device-icon-preview {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        color: var(--aura-primary);
        margin: 0 auto 1rem;
      }
      
      .icon-selector {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 0.75rem;
      }
      
      .icon-option {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        border: 2px solid #e2e8f0;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: #64748b;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .icon-option:hover {
        border-color: var(--aura-primary);
        color: var(--aura-primary);
      }
      
      .icon-option.selected {
        border-color: var(--aura-primary);
        background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
        color: var(--aura-primary);
      }
    </style>
  </head>
  <body>
    
    <!-- HEADER -->
    <header class="main-header">
      <div class="container">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <div class="d-flex align-items-center">
            <div class="logo-icon me-2">
              <i class="bi bi-shield-check"></i>
            </div>
            <div>
              <h1 class="h5 mb-0 fw-bold">AuraNet</h1>
              <p class="mb-0 opacity-75" style="font-size: 0.8125rem;">Home Network Protection</p>
            </div>
          </div>
          
          <div class="d-flex align-items-center gap-3">
            <nav class="d-none d-md-flex gap-1">
              <a href="{{ url_for('index') }}" class="nav-link-custom">
                <i class="bi bi-house-door me-1"></i>Home
              </a>
              <a href="{{ url_for('devices') }}" class="nav-link-custom active">
                <i class="bi bi-laptop me-1"></i>Devices
              </a>
              <a href="{{ url_for('health') }}" class="nav-link-custom">
                <i class="bi bi-heart-pulse me-1"></i>Health
              </a>
              <a href="{{ url_for('help_page') }}" class="nav-link-custom">
                <i class="bi bi-question-circle me-1"></i>Help
              </a>
            </nav>
            
            {% if is_protected %}
              <span class="status-pill status-protected">
                <i class="bi bi-check-circle-fill me-1"></i>Protected
              </span>
            {% else %}
              <span class="status-pill status-unprotected">
                <i class="bi bi-exclamation-circle-fill me-1"></i>Unprotected
              </span>
            {% endif %}
          </div>
        </div>
        
        <!-- Mobile Navigation -->
        <nav class="d-flex d-md-none gap-2 mt-3 justify-content-center flex-wrap">
          <a href="{{ url_for('index') }}" class="nav-link-custom">Home</a>
          <a href="{{ url_for('devices') }}" class="nav-link-custom active">Devices</a>
          <a href="{{ url_for('health') }}" class="nav-link-custom">Health</a>
          <a href="{{ url_for('help_page') }}" class="nav-link-custom">Help</a>
        </nav>
      </div>
    </header>

    <div class="container pb-4" style="max-width: 900px;">
      
      <!-- FLASH MESSAGES -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              <i class="bi {% if category == 'success' %}bi-check-circle-fill{% elif category == 'danger' %}bi-x-circle-fill{% elif category == 'warning' %}bi-exclamation-triangle-fill{% else %}bi-info-circle-fill{% endif %} me-2"></i>
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <!-- INFO BOX -->
      <div class="info-box">
        <h4><i class="bi bi-info-circle-fill me-2"></i>Your Connected Devices</h4>
        <p>
          These are all devices that have connected to your network. Click the <i class="bi bi-pencil"></i> icon to give each device a friendly name so you can easily identify them (e.g., "Dad's iPhone", "Living Room TV").
        </p>
      </div>

      <!-- DEVICES LIST -->
      <div class="aura-card">
        <div class="aura-card-header">
          <div class="header-icon" style="background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%); color: #2563eb;">
            <i class="bi bi-laptop"></i>
          </div>
          <h2>Network Devices</h2>
          <span class="badge bg-primary ms-auto" style="font-size: 0.75rem;">{{ devices|length }} devices</span>
        </div>
        <div class="aura-card-body">
          
          {% if devices %}
            {% for device in devices %}
            <div class="device-card">
              <div class="d-flex align-items-center gap-3">
                <div class="device-icon" style="color: {{ '#22c55e' if device.queries > 1000 else '#6366f1' if device.queries > 100 else '#94a3b8' }};">
                  <i class="bi bi-{{ device.icon if device.icon else 'laptop' }}"></i>
                </div>
                <div class="flex-grow-1 min-width-0">
                  <div class="device-name">
                    <span class="text-truncate">{{ device.custom_name if device.custom_name else device.name }}</span>
                    <i class="bi bi-pencil edit-btn" 
                       data-bs-toggle="modal" 
                       data-bs-target="#renameModal"
                       data-mac="{{ device.mac }}"
                       data-name="{{ device.custom_name if device.custom_name else device.name }}"
                       data-icon="{{ device.icon if device.icon else 'laptop' }}"
                       title="Rename device"></i>
                  </div>
                  <div class="device-meta">
                    <span><i class="bi bi-hdd-network me-1"></i>{{ device.ip }}</span>
                    {% if device.vendor and device.vendor != device.name and device.vendor != device.custom_name %}
                      <span class="separator">â€¢</span>
                      <span>{{ device.vendor }}</span>
                    {% endif %}
                  </div>
                  <div class="device-queries">
                    <i class="bi bi-activity me-1"></i>{{ "{:,}".format(device.queries) }} queries
                  </div>
                </div>
                <button class="btn btn-sm btn-outline-primary d-none d-md-inline-flex align-items-center" 
                        data-bs-toggle="modal" 
                        data-bs-target="#renameModal"
                        data-mac="{{ device.mac }}"
                        data-name="{{ device.custom_name if device.custom_name else device.name }}"
                        data-icon="{{ device.icon if device.icon else 'laptop' }}">
                  <i class="bi bi-pencil me-1"></i>Rename
                </button>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div class="empty-state">
              <i class="bi bi-wifi-off"></i>
              <h5>No Devices Found</h5>
              <p class="mb-0">Devices will appear here once they connect to your network and make DNS requests. This usually happens within a few minutes of the device connecting.</p>
            </div>
          {% endif %}
          
        </div>
      </div>

      <!-- COMING SOON -->
      <div class="info-box warning">
        <h4><i class="bi bi-stars me-2"></i>Coming Soon: Per-Device Filtering</h4>
        <p>
          In a future update, you'll be able to assign different protection levels to different devices. For example, maximum protection for kids' tablets and standard protection for adult devices. Currently, the protection level set on the Home page applies to all devices.
        </p>
      </div>

    </div>

    <!-- RENAME MODAL -->
    <div class="modal fade" id="renameModal" tabindex="-1" aria-labelledby="renameModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold" id="renameModalLabel">
              <i class="bi bi-pencil-square me-2 text-primary"></i>Rename Device
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="POST" action="" id="renameForm">
            <div class="modal-body">
              <div class="device-icon-preview" id="iconPreview">
                <i class="bi bi-laptop"></i>
              </div>
              
              <div class="mb-3">
                <label for="deviceName" class="form-label">Device Name</label>
                <input type="text" class="form-control" id="deviceName" name="custom_name" placeholder="e.g., Dad's iPhone, Living Room TV" required>
                <div class="form-text">Give this device a name you'll recognize</div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Device Icon</label>
                <div class="icon-selector">
                  <div class="icon-option" data-icon="phone" title="Phone">
                    <i class="bi bi-phone"></i>
                  </div>
                  <div class="icon-option" data-icon="tablet" title="Tablet">
                    <i class="bi bi-tablet"></i>
                  </div>
                  <div class="icon-option selected" data-icon="laptop" title="Laptop">
                    <i class="bi bi-laptop"></i>
                  </div>
                  <div class="icon-option" data-icon="pc-display" title="Desktop">
                    <i class="bi bi-pc-display"></i>
                  </div>
                  <div class="icon-option" data-icon="tv" title="TV">
                    <i class="bi bi-tv"></i>
                  </div>
                  <div class="icon-option" data-icon="speaker" title="Smart Speaker">
                    <i class="bi bi-speaker"></i>
                  </div>
                  <div class="icon-option" data-icon="controller" title="Game Console">
                    <i class="bi bi-controller"></i>
                  </div>
                  <div class="icon-option" data-icon="smartwatch" title="Smartwatch">
                    <i class="bi bi-smartwatch"></i>
                  </div>
                  <div class="icon-option" data-icon="printer" title="Printer">
                    <i class="bi bi-printer"></i>
                  </div>
                  <div class="icon-option" data-icon="router" title="Router/Network">
                    <i class="bi bi-router"></i>
                  </div>
                  <div class="icon-option" data-icon="house" title="Smart Home">
                    <i class="bi bi-house"></i>
                  </div>
                  <div class="icon-option" data-icon="question-circle" title="Other">
                    <i class="bi bi-question-circle"></i>
                  </div>
                </div>
                <input type="hidden" name="icon" id="selectedIcon" value="laptop">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-aura btn-aura-outline" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-aura btn-aura-primary">
                <i class="bi bi-check2 me-1"></i>Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer">
      <p class="mb-1"><a href="http://pi.hole/admin/" target="_blank"><i class="bi bi-speedometer2 me-1"></i>Advanced Settings</a></p>
      <p class="small mb-0">AuraNet Home Protection</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Handle rename modal
      const renameModal = document.getElementById('renameModal');
      renameModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const mac = button.getAttribute('data-mac');
        const name = button.getAttribute('data-name');
        const icon = button.getAttribute('data-icon') || 'laptop';
        
        // Set form action
        document.getElementById('renameForm').action = '/device/' + encodeURIComponent(mac) + '/rename';
        
        // Set current name
        document.getElementById('deviceName').value = name;
        
        // Set current icon
        document.getElementById('selectedIcon').value = icon;
        document.getElementById('iconPreview').innerHTML = '<i class="bi bi-' + icon + '"></i>';
        
        // Update icon selector
        document.querySelectorAll('.icon-option').forEach(opt => {
          opt.classList.remove('selected');
          if (opt.getAttribute('data-icon') === icon) {
            opt.classList.add('selected');
          }
        });
      });
      
      // Handle icon selection
      document.querySelectorAll('.icon-option').forEach(option => {
        option.addEventListener('click', function() {
          const icon = this.getAttribute('data-icon');
          
          // Update selection
          document.querySelectorAll('.icon-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          // Update hidden input
          document.getElementById('selectedIcon').value = icon;
          
          // Update preview
          document.getElementById('iconPreview').innerHTML = '<i class="bi bi-' + icon + '"></i>';
        });
      });
    </script>
  </body>
</html>
