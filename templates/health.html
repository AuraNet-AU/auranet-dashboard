{% extends "base.html" %}

{% block container_width %}800px{% endblock %}
{% block content_width %}800px{% endblock %}

{% block extra_styles %}
  .status-banner {
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .status-banner.healthy { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 2px solid #86efac; }
  .status-banner.warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #fcd34d; }
  .status-banner.error   { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 2px solid #fca5a5; }

  .status-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin: 0 auto 1rem;
  }

  .status-banner.healthy .status-icon { background: #22c55e; color: white; }
  .status-banner.warning .status-icon { background: #f59e0b; color: white; }
  .status-banner.error   .status-icon { background: #ef4444; color: white; }

  .check-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 10px;
    margin-bottom: 0.75rem;
  }

  .check-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    font-size: 1.125rem;
    flex-shrink: 0;
  }

  .check-icon.ok      { background: #dcfce7; color: #16a34a; }
  .check-icon.warning { background: #fef3c7; color: #d97706; }
  .check-icon.error   { background: #fee2e2; color: #dc2626; }

  .check-info { flex: 1; }
  .check-name    { font-weight: 600; color: #1e293b; font-size: 0.9375rem; }
  .check-message { font-size: 0.8125rem; color: #64748b; }

  .troubleshoot-box {
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-radius: 10px;
    padding: 1rem;
    margin-top: 0.75rem;
  }

  .troubleshoot-box h5 { font-size: 0.875rem; font-weight: 600; color: #92400e; margin-bottom: 0.5rem; }
  .troubleshoot-box ol { margin: 0; padding-left: 1.25rem; font-size: 0.8125rem; color: #78350f; }
  .troubleshoot-box li { margin-bottom: 0.25rem; }

  .btn-repair {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.8125rem;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    flex-shrink: 0;
  }

  .btn-repair:hover { color: white; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); }
{% endblock %}

{% set active_page = 'health' %}

{% block content %}

  <!-- OVERALL STATUS -->
  <div class="status-banner {{ health.overall_status }}">
    <div class="status-icon">
      {% if health.overall_status == 'healthy' %}
        <i class="bi bi-check-lg"></i>
      {% elif health.overall_status == 'warning' %}
        <i class="bi bi-exclamation-lg"></i>
      {% else %}
        <i class="bi bi-x-lg"></i>
      {% endif %}
    </div>
    <h2 class="h4 fw-bold mb-2">
      {% if health.overall_status == 'healthy' %}Everything is Working Great!
      {% elif health.overall_status == 'warning' %}Minor Issues Detected
      {% else %}Attention Needed{% endif %}
    </h2>
    <p class="mb-0 text-muted">
      {% if health.overall_status == 'healthy' %}Your AuraNet is running perfectly and protecting your network.
      {% elif health.overall_status == 'warning' %}Your protection is working, but there are some minor issues.
      {% else %}There's a problem that needs your attention. See details below.{% endif %}
    </p>
  </div>

  <!-- SYSTEM CHECKS -->
  <div class="aura-card">
    <div class="aura-card-header">
      <div class="header-icon" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #2563eb;">
        <i class="bi bi-clipboard-check"></i>
      </div>
      <h2>System Checks</h2>
    </div>
    <div class="aura-card-body">

      {% for check_id, check in health.checks.items() %}
      <div class="check-item">
        <div class="check-icon {{ check.status }}">
          {% if check.status == 'ok' %}<i class="bi bi-check-lg"></i>
          {% elif check.status == 'warning' %}<i class="bi bi-exclamation-lg"></i>
          {% else %}<i class="bi bi-x-lg"></i>{% endif %}
        </div>
        <div class="check-info">
          <div class="check-name">{{ check.name }}</div>
          <div class="check-message">{{ check.message }}</div>
        </div>
        {% if check.status != 'ok' and check_id in ['pihole_service', 'blocklist_database', 'dns_resolution'] %}
          <a href="{{ url_for('repair_issue', issue=check_id) }}" class="btn-repair">
            <i class="bi bi-wrench me-1"></i>Repair
          </a>
        {% endif %}
      </div>

      {% if check.status != 'ok' and check_id in troubleshooting %}
      <div class="troubleshoot-box">
        <h5><i class="bi bi-lightbulb me-1"></i>How to Fix</h5>
        <ol>
          {% for step in troubleshooting[check_id] %}
            <li>{{ step }}</li>
          {% endfor %}
        </ol>
      </div>
      {% endif %}
      {% endfor %}

    </div>
  </div>

  <!-- QUICK FIXES -->
  <div class="aura-card">
    <div class="aura-card-header">
      <div class="header-icon" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #d97706;">
        <i class="bi bi-tools"></i>
      </div>
      <h2>Quick Fixes</h2>
    </div>
    <div class="aura-card-body">
      <p class="text-muted mb-3" style="font-size: 0.875rem;">Try these if you're experiencing issues:</p>
      <div class="d-flex flex-wrap gap-2">
        <a href="{{ url_for('repair_issue', issue='dns_resolution') }}" class="btn btn-outline-primary">
          <i class="bi bi-arrow-clockwise me-1"></i>Restart DNS
        </a>
        <a href="{{ url_for('repair_issue', issue='blocklist_database') }}" class="btn btn-outline-primary">
          <i class="bi bi-database me-1"></i>Rebuild Blocklists
        </a>
        <a href="{{ url_for('repair_issue', issue='pihole_service') }}" class="btn btn-outline-primary">
          <i class="bi bi-power me-1"></i>Restart Protection
        </a>
      </div>
    </div>
  </div>

  <!-- CONTACT SUPPORT -->
  <div class="aura-card">
    <div class="aura-card-header">
      <div class="header-icon" style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); color: #4f46e5;">
        <i class="bi bi-headset"></i>
      </div>
      <h2>Need More Help?</h2>
    </div>
    <div class="aura-card-body text-center">
      <p class="text-muted mb-3">If the automatic fixes don't work, we're here to help.</p>
      <a href="mailto:support@getauranet.com.au" class="btn btn-primary">
        <i class="bi bi-envelope me-2"></i>Contact Support
      </a>
      <p class="small text-muted mt-3 mb-0">When contacting support, please include a screenshot of this page.</p>
    </div>
  </div>

{% endblock %}
