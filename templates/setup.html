{% extends "base.html" %}

{% block container_width %}800px{% endblock %}
{% block content_width %}800px{% endblock %}

{% block extra_styles %}
  .wizard-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.05);
  }

  .wizard-header {
    background: linear-gradient(135deg, var(--aura-primary) 0%, var(--aura-primary-dark) 100%);
    padding: 1.75rem 2rem 1.25rem;
    color: white;
  }

  .wizard-header h2 {
    font-size: 1.375rem;
    font-weight: 700;
    margin: 0 0 0.25rem;
  }

  .wizard-header p {
    font-size: 0.9rem;
    opacity: 0.85;
    margin: 0;
  }

  /* Progress steps */
  .progress-steps {
    display: flex;
    align-items: center;
    margin-top: 1.25rem;
    gap: 0;
  }

  .progress-step {
    display: flex;
    align-items: center;
    flex: 1;
  }

  .step-dot {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
    flex-shrink: 0;
    transition: all 0.3s;
  }

  .step-dot.done {
    background: rgba(255,255,255,0.9);
    color: var(--aura-primary-dark);
  }

  .step-dot.active {
    background: white;
    color: var(--aura-primary-dark);
    box-shadow: 0 0 0 3px rgba(255,255,255,0.4);
  }

  .step-dot.pending {
    background: rgba(255,255,255,0.25);
    color: rgba(255,255,255,0.7);
  }

  .step-line {
    flex: 1;
    height: 2px;
    background: rgba(255,255,255,0.25);
    margin: 0 4px;
  }

  .step-line.done {
    background: rgba(255,255,255,0.8);
  }

  .wizard-body {
    padding: 2rem;
  }

  /* Product selection cards */
  .product-card {
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    padding: 1.75rem;
    cursor: pointer;
    transition: all 0.25s ease;
    background: white;
    height: 100%;
    text-align: center;
  }

  .product-card:hover {
    border-color: var(--aura-primary);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.15);
  }

  .product-icon {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--aura-primary) 0%, var(--aura-primary-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin: 0 auto 1.25rem;
  }

  .product-card h3 {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.25rem;
  }

  .product-card .price-tag {
    font-size: 1rem;
    font-weight: 700;
    color: var(--aura-primary);
    margin-bottom: 0.75rem;
  }

  .product-card p {
    font-size: 0.875rem;
    color: #64748b;
    line-height: 1.5;
    margin: 0;
  }

  /* Setup steps */
  .setup-step-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.25rem;
  }

  .setup-step-item:last-child {
    margin-bottom: 0;
  }

  .setup-step-number {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--aura-primary) 0%, var(--aura-primary-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.9rem;
    flex-shrink: 0;
    margin-right: 1rem;
    margin-top: 0.1rem;
  }

  .setup-step-content h5 {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.25rem;
  }

  .setup-step-content p {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0;
    line-height: 1.5;
  }

  .critical-step {
    background: #fef3c7;
    border: 1px solid #fcd34d;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: #92400e;
  }

  .critical-step i { color: #d97706; margin-right: 0.4rem; }

  /* Internet check */
  .check-result {
    display: flex;
    align-items: center;
    padding: 0.875rem 1.125rem;
    border-radius: 10px;
    margin-bottom: 0.75rem;
    font-weight: 500;
    font-size: 0.9375rem;
  }

  .check-result.checking { background: #f1f5f9; color: #64748b; }
  .check-result.ok { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
  .check-result.fail { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
  .check-result i { font-size: 1.25rem; margin-right: 0.75rem; }

  /* Device cards */
  .wizard-device-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 0.75rem;
  }

  .wizard-device-card .device-header {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .wizard-device-icon {
    width: 42px;
    height: 42px;
    border-radius: 10px;
    background: var(--aura-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    margin-right: 0.875rem;
    flex-shrink: 0;
  }

  .device-meta { flex: 1; }
  .device-meta strong { font-size: 0.9375rem; color: #1e293b; display: block; }
  .device-meta span { font-size: 0.8125rem; color: #64748b; }

  /* Mode cards for wizard */
  .wizard-mode-card {
    border: 2px solid #e2e8f0;
    border-radius: 14px;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.25s ease;
    background: white;
    height: 100%;
    text-align: center;
  }

  .wizard-mode-card:hover {
    border-color: var(--aura-primary);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
  }

  .wizard-mode-icon {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--aura-primary) 0%, var(--aura-primary-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin: 0 auto 1rem;
  }

  .wizard-mode-card h4 {
    font-size: 1rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.375rem;
  }

  .wizard-mode-card p {
    font-size: 0.8125rem;
    color: #64748b;
    margin: 0;
    line-height: 1.4;
  }

  /* Done screen */
  .done-icon {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--aura-success) 0%, #16a34a 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    margin: 0 auto 1.5rem;
    box-shadow: 0 8px 25px rgba(34, 197, 94, 0.35);
  }

  .summary-pill {
    display: inline-flex;
    align-items: center;
    background: #f1f5f9;
    border-radius: 20px;
    padding: 0.4rem 1rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #475569;
    margin: 0.25rem;
  }

  .summary-pill i { margin-right: 0.4rem; color: var(--aura-primary); }
{% endblock %}

{% block content %}
{% set active_page = 'home' %}

<div class="wizard-card">
  <!-- Wizard Header with progress -->
  <div class="wizard-header">
    <h2>
      {% if step == 1 %}Welcome to AuraNet
      {% elif step == 2 %}Connect Your Device
      {% elif step == 3 %}Test Your Connection
      {% elif step == 4 %}Name Your Devices
      {% elif step == 5 %}Choose Protection Level
      {% elif step == 6 %}You're All Set!
      {% endif %}
    </h2>
    <p>
      {% if step == 1 %}Let's get your network protection up and running.
      {% elif step == 2 %}Follow the steps below to connect AuraNet to your network.
      {% elif step == 3 %}Making sure everything is working correctly.
      {% elif step == 4 %}Give your devices friendly names so you can recognise them.
      {% elif step == 5 %}Select the level of protection that's right for your household.
      {% elif step == 6 %}AuraNet is protecting your home network.
      {% endif %}
    </p>

    <!-- Progress indicator -->
    <div class="progress-steps mt-3">
      {% for i in range(1, 7) %}
        <div class="progress-step">
          <div class="step-dot {% if i < step %}done{% elif i == step %}active{% else %}pending{% endif %}">
            {% if i < step %}<i class="bi bi-check"></i>{% else %}{{ i }}{% endif %}
          </div>
          {% if not loop.last %}
            <div class="step-line {% if i < step %}done{% endif %}"></div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="wizard-body">

    <!-- ==================== STEP 1: PRODUCT SELECTION ==================== -->
    {% if step == 1 %}
    <p class="text-muted mb-4" style="font-size:0.9375rem;">Which AuraNet product do you have? This helps us give you the right setup instructions.</p>
    <div class="row g-3">
      <div class="col-md-6">
        <form method="POST" action="{{ url_for('setup', step=1) }}" class="h-100">
          <input type="hidden" name="action" value="select_product">
          <input type="hidden" name="product" value="smart_wifi_kit">
          <button type="submit" class="product-card w-100 border-0 p-0" style="background:none;">
            <div class="product-card">
              <div class="product-icon"><i class="bi bi-wifi"></i></div>
              <h3>Smart Wi-Fi Kit</h3>
              <div class="price-tag">$499</div>
              <p>AuraNet <em>is</em> your Wi-Fi router. Plug it into your modem and connect your devices to its Wi-Fi — no router changes needed.</p>
            </div>
          </button>
        </form>
      </div>
      <div class="col-md-6">
        <form method="POST" action="{{ url_for('setup', step=1) }}" class="h-100">
          <input type="hidden" name="action" value="select_product">
          <input type="hidden" name="product" value="network_supercharger">
          <button type="submit" class="product-card w-100 border-0 p-0" style="background:none;">
            <div class="product-card">
              <div class="product-icon" style="background: linear-gradient(135deg, #6366f1 0%, #7c3aed 100%);"><i class="bi bi-hdd-network"></i></div>
              <h3>Network Supercharger</h3>
              <div class="price-tag">$299</div>
              <p>Works alongside your existing router. A quick DNS change in your router settings, and every device gets protected automatically.</p>
            </div>
          </button>
        </form>
      </div>
    </div>

    <!-- ==================== STEP 2: NETWORK SETUP ==================== -->
    {% elif step == 2 %}
    {% set product = settings.get('setup_product') %}

    {% if product == 'smart_wifi_kit' %}
    <div class="mb-4">
      <div class="d-flex align-items-center mb-3">
        <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--aura-primary) 0%,var(--aura-primary-dark) 100%);color:white;display:flex;align-items:center;justify-content:center;font-size:1.25rem;margin-right:0.875rem;flex-shrink:0;"><i class="bi bi-wifi"></i></div>
        <div><strong style="font-size:1rem;color:#1e293b;">Smart Wi-Fi Kit Setup</strong><br><span style="font-size:0.8125rem;color:#64748b;">AuraNet replaces your existing Wi-Fi router</span></div>
      </div>
      <div class="setup-step-item">
        <div class="setup-step-number">1</div>
        <div class="setup-step-content">
          <h5>Connect to your modem or NBN box</h5>
          <p>Plug the ethernet cable from your modem/NBN box into the <strong>WAN port</strong> on the back of your AuraNet device. (It's usually labelled "WAN" or has a globe/internet icon.)</p>
        </div>
      </div>
      <div class="setup-step-item">
        <div class="setup-step-number">2</div>
        <div class="setup-step-content">
          <h5>Connect your devices to AuraNet Wi-Fi</h5>
          <p>On your phone, laptop, and other devices, connect to the <strong>AuraNet</strong> Wi-Fi network. All traffic will automatically flow through AuraNet's protection — no further configuration needed.</p>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-center p-3 rounded-3 mb-4" style="background:#f0fdf4;border:1px solid #bbf7d0;">
      <i class="bi bi-check-circle-fill text-success me-2" style="font-size:1.25rem;"></i>
      <span style="font-size:0.9rem;color:#166534;">That's it! Your old router is no longer needed. AuraNet handles everything.</span>
    </div>

    {% elif product == 'network_supercharger' %}
    <div class="mb-4">
      <div class="d-flex align-items-center mb-3">
        <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#6366f1 0%,#7c3aed 100%);color:white;display:flex;align-items:center;justify-content:center;font-size:1.25rem;margin-right:0.875rem;flex-shrink:0;"><i class="bi bi-hdd-network"></i></div>
        <div><strong style="font-size:1rem;color:#1e293b;">Network Supercharger Setup</strong><br><span style="font-size:0.8125rem;color:#64748b;">Works alongside your existing router</span></div>
      </div>
      <div class="setup-step-item">
        <div class="setup-step-number">1</div>
        <div class="setup-step-content">
          <h5>Connect AuraNet to your router</h5>
          <p>Plug an ethernet cable from any LAN port on your router into the ethernet port on your AuraNet device.</p>
        </div>
      </div>
      <div class="setup-step-item">
        <div class="setup-step-number">2</div>
        <div class="setup-step-content">
          <h5>Log into your router's admin page</h5>
          <p>Open a browser and go to <strong>192.168.0.1</strong> or <strong>192.168.1.1</strong> (try both if one doesn't load). Log in with your router's admin username and password.</p>
        </div>
      </div>
      <div class="setup-step-item">
        <div class="setup-step-number">3</div>
        <div class="setup-step-content">
          <h5>Set the DNS server to AuraNet's IP address</h5>
          <p>Find the <strong>DHCP settings</strong> (sometimes under "LAN" or "Network"). Set the <strong>Primary DNS</strong> to:</p>
          <div class="critical-step">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <strong>DNS Server: {{ pi_ip }}</strong> — This is the most important step. If devices keep getting this address from your router, all their traffic will be filtered by AuraNet.
          </div>
        </div>
      </div>
      <div class="setup-step-item">
        <div class="setup-step-number">4</div>
        <div class="setup-step-content">
          <h5>Save and restart your router</h5>
          <p>Save the settings and restart your router. After it reboots (about 1–2 minutes), all devices that reconnect will use AuraNet for DNS filtering.</p>
        </div>
      </div>
    </div>

    {% else %}
    <div class="text-center py-4">
      <p class="text-muted">No product selected. <a href="{{ url_for('setup', step=1) }}">Go back and choose your product.</a></p>
    </div>
    {% endif %}

    {% if product %}
    <form method="POST" action="{{ url_for('setup', step=2) }}">
      <input type="hidden" name="action" value="next_step">
      <input type="hidden" name="next" value="3">
      <button type="submit" class="btn-aura btn-aura-primary w-100">
        <i class="bi bi-arrow-right me-2"></i>Next: Test Connection
      </button>
    </form>
    {% endif %}

    <!-- ==================== STEP 3: INTERNET CHECK ==================== -->
    {% elif step == 3 %}
    <p class="text-muted mb-4" style="font-size:0.9375rem;">Let's verify that your internet and DNS are working correctly through AuraNet.</p>

    <div id="check-internet" class="check-result checking">
      <i class="bi bi-arrow-repeat spin-icon"></i>
      <span>Checking internet connection...</span>
    </div>
    <div id="check-dns" class="check-result checking">
      <i class="bi bi-arrow-repeat spin-icon"></i>
      <span>Checking DNS filtering...</span>
    </div>

    <div id="check-error" class="d-none mt-3">
      <div class="d-flex align-items-start p-3 rounded-3" style="background:#fef2f2;border:1px solid #fecaca;">
        <i class="bi bi-exclamation-circle-fill text-danger me-2 mt-1" style="font-size:1.1rem;flex-shrink:0;"></i>
        <div style="font-size:0.875rem;color:#991b1b;">
          <strong>Connection issue detected.</strong> Make sure you've completed the setup steps and your router has restarted, then click Re-check.
        </div>
      </div>
    </div>

    <div class="d-flex gap-2 mt-4" id="check-actions" style="display:none!important;">
      <button onclick="runChecks()" class="btn-aura btn-aura-outline flex-fill">
        <i class="bi bi-arrow-clockwise me-2"></i>Re-check
      </button>
    </div>

    <form method="POST" action="{{ url_for('setup', step=3) }}" id="step3-form" class="mt-3">
      <input type="hidden" name="action" value="next_step">
      <input type="hidden" name="next" value="4">
      <button type="submit" class="btn-aura btn-aura-primary w-100" id="continue-btn" disabled>
        <i class="bi bi-arrow-right me-2"></i>Continue
      </button>
    </form>
    <div class="text-center mt-2">
      <form method="POST" action="{{ url_for('setup', step=3) }}" style="display:inline;">
        <input type="hidden" name="action" value="next_step">
        <input type="hidden" name="next" value="4">
        <button type="submit" class="btn btn-sm btn-link text-muted">Skip this check</button>
      </form>
    </div>

    <!-- ==================== STEP 4: NAME DEVICES ==================== -->
    {% elif step == 4 %}
    <p class="text-muted mb-4" style="font-size:0.9375rem;">AuraNet has detected these devices on your network. Give them names so you can recognise them easily.</p>

    {% if devices %}
      {% for device in devices %}
      <div class="wizard-device-card">
        <div class="device-header">
          <div class="wizard-device-icon">
            <i class="bi bi-{{ device.icon or 'laptop' }}"></i>
          </div>
          <div class="device-meta">
            <strong>{{ device.custom_name or device.name }}</strong>
            <span>{{ device.ip }} &nbsp;·&nbsp; {{ device.vendor or device.mac[-8:] }}</span>
          </div>
        </div>
        <form method="POST" action="{{ url_for('setup', step=4) }}" class="d-flex gap-2 align-items-center">
          <input type="hidden" name="action" value="rename_device">
          <input type="hidden" name="mac" value="{{ device.mac }}">
          <input type="hidden" name="icon" value="{{ device.icon or 'laptop' }}">
          <input type="text" name="name" value="{{ device.custom_name or device.name }}"
                 class="aura-input" placeholder="Device name" style="font-size:0.875rem;padding:0.5rem 0.875rem;">
          <button type="submit" class="btn-aura btn-aura-primary" style="padding:0.5rem 1rem;min-height:40px;font-size:0.875rem;white-space:nowrap;">
            <i class="bi bi-check me-1"></i>Save
          </button>
        </form>
      </div>
      {% endfor %}
    {% else %}
      <div class="text-center py-4 text-muted">
        <i class="bi bi-laptop" style="font-size:2.5rem;display:block;margin-bottom:0.75rem;opacity:0.4;"></i>
        <p>No devices detected yet. This is normal if your router hasn't fully restarted.<br>You can always name devices later on the Devices page.</p>
      </div>
    {% endif %}

    <form method="POST" action="{{ url_for('setup', step=4) }}" class="mt-3">
      <input type="hidden" name="action" value="next_step">
      <input type="hidden" name="next" value="5">
      <button type="submit" class="btn-aura btn-aura-primary w-100">
        <i class="bi bi-arrow-right me-2"></i>Next: Choose Protection
      </button>
    </form>

    <!-- ==================== STEP 5: CHOOSE PROTECTION ==================== -->
    {% elif step == 5 %}
    <p class="text-muted mb-4" style="font-size:0.9375rem;">Choose the protection level that suits your household. You can change this anytime from the dashboard.</p>
    <div class="row g-3">
      {% for mode_id, mode in modes.items() %}
      <div class="col-md-4">
        <form method="POST" action="{{ url_for('setup', step=5) }}" class="h-100">
          <input type="hidden" name="action" value="set_mode">
          <input type="hidden" name="mode" value="{{ mode_id }}">
          <button type="submit" class="wizard-mode-card w-100 border-0 p-0" style="background:none;">
            <div class="wizard-mode-card">
              <div class="wizard-mode-icon" style="background:linear-gradient(135deg, {{ mode.color }} 0%, {{ mode.color }}cc 100%);">
                <i class="bi {{ mode.icon }}"></i>
              </div>
              <h4>{{ mode.name }}</h4>
              <p>{{ mode.description }}</p>
            </div>
          </button>
        </form>
      </div>
      {% endfor %}
    </div>

    <!-- ==================== STEP 6: DONE ==================== -->
    {% elif step == 6 %}
    <div class="text-center py-2">
      <div class="done-icon">
        <i class="bi bi-shield-check"></i>
      </div>
      <h3 style="font-size:1.5rem;font-weight:700;color:#1e293b;margin-bottom:0.5rem;">AuraNet is active!</h3>
      <p class="text-muted mb-4" style="font-size:0.9375rem;">Your home network is now protected. Here's a summary of your setup:</p>

      <div class="mb-4">
        {% if settings.get('setup_product') == 'smart_wifi_kit' %}
        <span class="summary-pill"><i class="bi bi-wifi"></i> Smart Wi-Fi Kit</span>
        {% elif settings.get('setup_product') == 'network_supercharger' %}
        <span class="summary-pill"><i class="bi bi-hdd-network"></i> Network Supercharger</span>
        {% endif %}

        {% set mode_name = settings.get('protection_mode', 'standard') %}
        {% if mode_name in modes %}
        <span class="summary-pill"><i class="bi {{ modes[mode_name].icon }}"></i> {{ modes[mode_name].name }}</span>
        {% endif %}
      </div>

      <div class="d-flex align-items-start p-3 rounded-3 mb-4 text-start" style="background:#f0fdf4;border:1px solid #bbf7d0;">
        <i class="bi bi-info-circle-fill me-2 mt-1" style="color:#22c55e;flex-shrink:0;"></i>
        <span style="font-size:0.875rem;color:#166534;">Blocklists are updating in the background — this takes 2–3 minutes. Your protection is already active.</span>
      </div>

      <form method="POST" action="{{ url_for('setup', step=6) }}">
        <input type="hidden" name="action" value="complete">
        <button type="submit" class="btn-aura btn-aura-success w-100" style="font-size:1rem;">
          <i class="bi bi-house-door me-2"></i>Go to Dashboard
        </button>
      </form>
    </div>
    {% endif %}

  </div><!-- /.wizard-body -->
</div><!-- /.wizard-card -->
{% endblock %}

{% block scripts %}
{% if step == 3 %}
<style>
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .spin-icon { display: inline-block; animation: spin 1s linear infinite; }
</style>
<script>
  function setCheck(id, status, text) {
    const el = document.getElementById(id);
    el.className = 'check-result ' + status;
    const icon = status === 'ok'
      ? '<i class="bi bi-check-circle-fill"></i>'
      : status === 'fail'
        ? '<i class="bi bi-x-circle-fill"></i>'
        : '<i class="bi bi-arrow-repeat spin-icon"></i>';
    el.innerHTML = icon + '<span>' + text + '</span>';
  }

  function runChecks() {
    document.getElementById('continue-btn').disabled = true;
    document.getElementById('check-actions').style.display = 'none';
    document.getElementById('check-error').classList.add('d-none');
    setCheck('check-internet', 'checking', 'Checking internet connection...');
    setCheck('check-dns', 'checking', 'Checking DNS filtering...');

    fetch('/setup/check-internet')
      .then(r => r.json())
      .then(data => {
        setCheck('check-internet', data.internet ? 'ok' : 'fail',
          data.internet ? 'Internet connection is working' : 'No internet connection detected');
        setCheck('check-dns', data.dns ? 'ok' : 'fail',
          data.dns ? 'DNS filtering is active' : 'DNS is not routing through AuraNet yet');

        if (data.ok) {
          document.getElementById('continue-btn').disabled = false;
        } else {
          document.getElementById('check-error').classList.remove('d-none');
          document.getElementById('check-actions').style.removeProperty('display');
        }
      })
      .catch(() => {
        setCheck('check-internet', 'fail', 'Could not reach AuraNet — are you connected to the right network?');
        setCheck('check-dns', 'fail', 'DNS check failed');
        document.getElementById('check-error').classList.remove('d-none');
        document.getElementById('check-actions').style.removeProperty('display');
      });
  }

  runChecks();
</script>
{% endif %}
{% endblock %}
